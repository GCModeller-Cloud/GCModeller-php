<link href="http://www.biodeep.cn/css/bootstrap.min.css" rel="stylesheet" />
<link href="http://gcmodeller.org/styles/font-awesome.css" rel="stylesheet" type="text/css">

<script src="http://www.biodeep.cn/js/jquery.min.js"></script>
<script src="http://www.biodeep.cn/js/bootstrap.min.js"></script>

<body>

    <!--
            假设iTraq输入的原始矩阵数据任然是使用同位素的通道数字id来标记的
            则这里就是将
        -->

    <ul class="nav nav-tabs">
        <li class="active">
            <a data-toggle="tab" href="#home">iTraq Symbols</a>
        </li>
        <li>
            <a data-toggle="tab" href="#menu1">SampleInfo</a>
        </li>
        <li>
            <a data-toggle="tab" href="#menu2">Experiment Designer</a>
        </li>
    </ul>

    <div class="tab-content">
        <div id="home" class="tab-pane fade in active">

            <br />

            <center>

                <div class="table-responsive">
                    <table style="width: 85%;" class="table">
                        <thead>
                            <tr>
                                <th style="width:10%;">NO.</th>
                                <th style="width:30%;">Symbol</th>
                                <th style="width:30%;">SampleID</th>
                                <th style="width:30%;">Operation</th>
                            </tr>
                        </thead>
                        <tbody id="symbol-table">

                        </tbody>
                    </table>
                </div>

                <hr />

                <div style="width:100%; text-align: left;">

                    <span style="margin-left: 5em;">
                        <a href="#" onclick="addSymbol();">
                            <i class="fa fa-plus"></i> Add Symbol
                        </a>
                    </span>

                </div>

                <script id="hidden-template" type="text/x-custom-template">
                    <tr>
                        <td id="row-new"></td>
                        <td><input id="input-symbol" type="text" style="width: 65%" class="form-control"></input></td>
                        <td><input id="input-sampleID" type="text" style="width: 65%" class="form-control"></input></td>
                        <td>
                            <div id="row-new-pending">
                                <a href="#" onclick="newRowWrite(this.parentNode);">
                                    <span class="label label-success">OK</span>
                                </a>&nbsp;
                                <a href="#" onclick="newRowCancel();">
                                    <span class="label label-warning">Cancel</span>
                                </a>
                            </div>
                            <div class="remove-button" style="display:none;">
                                <a href="#" onclick="remove(this);">
                                    <span class="label label-warning">Remove</span>
                                </a>
                                <a href="#" onclick="edit(this);">
                                    <span class="label label-info">Edit</span>
                                </a>
                            </div>
                            <div class="edit-button" style="display:none;">
                                <a href="#" onclick="edit_write(this.parentNode);">
                                    <span class="label label-success">OK</span>
                                </a>                                
                            </div>
                        </td>
                    <tr>
                </script>

                <script type="text/javascript">

                    var symbols = 0;
                    var edit_lock = false;

                    function addSymbol() {
                        // 先检查是否存在没有写入数据的row
                        var rowNew = document.getElementById("row-new");

                        if (rowNew || edit_lock) {
                            // 不添加
                        } else {
                            $('#symbol-table').append($('#hidden-template').html());
                        }
                    }

                    function newRowCancel() {
                        console.log("--");
                        $('#symbol-table tr:last').remove();
                        $('#symbol-table tr:last').remove();
                    }

                    function newRowWrite(i) {
                        if (!$("#input-symbol").val() || !$("#input-sampleID").val()) {
                            // 给出输入不为空的警告
                        } else {
                            var td = i.parentNode;
                            var tr = td.parentNode;

                            td.removeChild(i);

                            $(".remove-button").show();

                            var NO = ++symbols;
                            var symbol = $("#input-symbol").val();
                            var sampleID = $("#input-sampleID").val();

                            var childs = tr.childNodes;

                            childs[1].innerText = NO;
                            childs[1].id = NO;
                            childs[3].innerText = symbol;
                            childs[5].innerText = sampleID;

                            tableData("symbol-table");
                        }
                    }

                    function remove(i) {
                        var tr = i.parentNode  // div
                            .parentNode  // td
                            .parentNode; // tr                       

                        tr.parentNode.removeChild(tr);
                    }

                    function edit(i) {
                        var td = i.parentNode.parentNode;
                        var tr = td.parentNode; // tr

                        var childs = tr.childNodes;

                        // console.log(childs);

                        var symbol = childs[3].innerText;
                        var sampleID = childs[5].innerText;

                        childs[3].innerHTML = '<input id="input-symbol" type="text" style="width: 65%" class="form-control" value="' + symbol + '"></input>';
                        childs[5].innerHTML = '<input id="input-sampleID" type="text" style="width: 65%" class="form-control" value="' + sampleID + '"></input>';

                        i.parentNode.style.display = "none";

                        var div = td.childNodes;

                        div[4].style.display = "block";

                        edit_lock = true;
                    }

                    function edit_write(i) {
                        var td = i.parentNode;
                        var tr = td.parentNode; // tr

                        var childs = tr.childNodes;
                        var symbol = $("#input-symbol").val();
                        var sampleID = $("#input-sampleID").val();

                        console.log(childs);

                        childs[3].innerText = symbol;
                        childs[5].innerText = sampleID;

                        $(".remove-button").show();
                        $(".edit-button").hide();

                        edit_lock = false;

                        tableData("symbol-table");
                    }                    
                </script>

                <script language="javascript" type="text/javascript">
                    function tableData(id) {
                        var table = {};
                        var tr = $("#" + id + " tr").each(function () {
                            var row = [];

                            $(this).children("td").each(function () {
                                row.push($(this).text());
                            });

                            row.pop();
                            table[row[0]] = row;
                        });

                        console.log(table);

                        $(".remove-button").show();

                    }                    
                </script>
            </center>

        </div>
        <div id="menu1" class="tab-pane fade">
            <h3>Menu 1</h3>
            <p>Some content in menu 1.</p>
        </div>
        <div id="menu2" class="tab-pane fade">
            <h3>Menu 2</h3>
            <p>Some content in menu 2.</p>
        </div>
    </div>

</body>